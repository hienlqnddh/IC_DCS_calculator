<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tính PLC Dòng</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="clock">...</div>
    <div class="container">
        <h1>CÔNG CỤ HỖ TRỢ TÍNH TOÁN-CHUYỂN ĐỔI THÔNG SỐ DCS</h1>
        <h2>TÍNH TOÁN -CHUYỂN ĐỔI THÔNG SỐ CHO MODULE ANALOG PLC (Đo dòng)</h2>
        <p style="text-align: center;">(Áp dụng cho PLC Siemens S7-300/400/1200/1500)</p>

        <div class="input-group">
            <h3>CN1: Tính Scale (Dạng 4-20mA)</h3>
            <p style="font-size: 14px; color: #d63384;">*Lưu ý: Áp dụng khi Module đã cấu hình Mode 4-20mA</p>
            <label>Zero (Giá trị thực tại 4mA):</label>
            <input type="number" id="plc_c1_zero" placeholder="Ví dụ: 0">
            <label>Span (Giá trị thực tại 20mA):</label>
            <input type="number" id="plc_c1_span" placeholder="Ví dụ: 100" style="margin-top:5px;">
            <label>Giá trị Raw (Thô):</label><input type="number" id="plc_c1_raw" placeholder="Nhập từ 0 đến 27648">
            <button onclick="calcPLC_C1()">Quy đổi</button>
            <div class="result" id="res_plc_c1">Kết quả Scaling: ...</div>
            <div class="tech-note">
                <strong>Chú thích kỹ thuật quan trọng (Vấn đề 5530):</strong><br>
                - Công thức này áp dụng cho Module đã cấu hình Hardware là <strong>4-20mA</strong>.<br>
                - Khi đó: 4mA tương ứng Raw = <strong>0</strong>; 20mA tương ứng Raw = <strong>27648</strong>.<br>
                - Nếu Module cấu hình là <strong>0-20mA</strong> nhưng đo thiết bị 4-20mA, thì 4mA = Raw 5530 (Lúc này công thức trên không đúng).
            </div>
        </div>

        <div class="input-group">
            <h3>CN2: Tính Scale (Dạng 0-20mA)</h3>
            <label>Zero (Giá trị thực tại 0mA):</label>
            <input type="number" id="plc_c2_zero">
            <label>Span (Giá trị thực tại 20mA):</label>
            <input type="number" id="plc_c2_span" style="margin-top:5px;">
            <label>Giá trị Raw (Thô):</label><input type="number" id="plc_c2_raw">
            <button onclick="calcPLC_C2()">Quy đổi</button>
            <div class="result" id="res_plc_c2">Kết quả Scaling: ...</div>
            <div class="tech-note">
                Dãy Raw tiêu chuẩn Siemens: 0mA = 0; 20mA = 27648.<br>
                Công thức: Scale = ((Raw / 27648) * (Span - Zero)) + Zero.
            </div>
        </div>

        <div class="input-group">
            <h3>CN3: Tính Raw từ Scale (Dạng 4-20mA)</h3>
            <label>Zero / Span:</label>
            <input type="number" id="plc_c3_zero" placeholder="Zero">
            <input type="number" id="plc_c3_span" placeholder="Span" style="margin-top:5px;">
            <label>Giá trị Scaling muốn quy đổi:</label><input type="number" id="plc_c3_val">
            <button onclick="calcPLC_C3()">Quy đổi Raw</button>
            <div class="result" id="res_plc_c3">Kết quả Raw: ...</div>
            <div class="tech-note">
                Trả về giá trị Raw để nạp vào PLC (Giả định module config 4-20mA).<br>
                Kết quả nằm trong khoảng 0 đến 27648.
            </div>
        </div>

        <div class="input-group">
            <h3>CN4: Tính Raw từ Scale (Dạng 0-20mA)</h3>
            <label>Zero / Span:</label>
            <input type="number" id="plc_c4_zero" placeholder="Zero">
            <input type="number" id="plc_c4_span" placeholder="Span" style="margin-top:5px;">
            <label>Giá trị Scaling muốn quy đổi:</label><input type="number" id="plc_c4_val">
            <button onclick="calcPLC_C4()">Quy đổi Raw</button>
            <div class="result" id="res_plc_c4">Kết quả Raw: ...</div>
        </div>

        <a href="index.html" class="btn-link btn-back">Quay lại trang chính</a>
    </div>

    <script>
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = "Thời gian thực: " + now.toLocaleString('vi-VN');
        }
        setInterval(updateClock, 1000); updateClock();

        // Hàm tính toán chung (Sử dụng chuẩn 0-27648)
        function plcScale(raw, z, s) { 
            // Nếu raw < 0 thì coi như bằng 0 (cắt nhiễu âm)
            if (raw < 0) raw = 0;
            return ((raw / 27648) * (s - z)) + z; 
        }
        
        function plcRaw(val, z, s) { 
            return ((val - z) / (s - z)) * 27648; 
        }

        function calcPLC_C1() {
            let z = parseFloat(document.getElementById('plc_c1_zero').value);
            let s = parseFloat(document.getElementById('plc_c1_span').value);
            let r = parseFloat(document.getElementById('plc_c1_raw').value);
            if(isNaN(z) || isNaN(s) || isNaN(r)) {alert("Vui lòng nhập đủ thông tin"); return;}
            
            document.getElementById('res_plc_c1').innerText = `Kết quả Scaling: ${plcScale(r, z, s).toFixed(2)}`;
        }

        function calcPLC_C2() {
            let z = parseFloat(document.getElementById('plc_c2_zero').value);
            let s = parseFloat(document.getElementById('plc_c2_span').value);
            let r = parseFloat(document.getElementById('plc_c2_raw').value);
            if(isNaN(z) || isNaN(s) || isNaN(r)) {alert("Vui lòng nhập đủ thông tin"); return;}

            document.getElementById('res_plc_c2').innerText = `Kết quả Scaling: ${plcScale(r, z, s).toFixed(2)}`;
        }

        function calcPLC_C3() {
            let z = parseFloat(document.getElementById('plc_c3_zero').value);
            let s = parseFloat(document.getElementById('plc_c3_span').value);
            let v = parseFloat(document.getElementById('plc_c3_val').value);
            if(isNaN(z) || isNaN(s) || isNaN(v)) {alert("Vui lòng nhập đủ thông tin"); return;}

            let res = plcRaw(v, z, s);
            document.getElementById('res_plc_c3').innerText = `Kết quả Raw: ${Math.round(res)} (Word)`;
        }

        function calcPLC_C4() {
            let z = parseFloat(document.getElementById('plc_c4_zero').value);
            let s = parseFloat(document.getElementById('plc_c4_span').value);
            let v = parseFloat(document.getElementById('plc_c4_val').value);
            if(isNaN(z) || isNaN(s) || isNaN(v)) {alert("Vui lòng nhập đủ thông tin"); return;}

            let res = plcRaw(v, z, s);
            document.getElementById('res_plc_c4').innerText = `Kết quả Raw: ${Math.round(res)} (Word)`;
        }
    </script>
</body>
</html>
